{% extends "base.html" %}

{% block page_title %}New Delivery{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>New Delivery</h2>
    </div>
    <div class="card-body">
        <form method="post">
            <div class="form-grid">
                <div class="form-group">
                    <label>Delivery Date</label>
                    <input type="date" name="delivery_date" required>
                </div>
                <div class="form-group">
                    <label>Customer Name</label>
                    <input type="text" name="customer_name" required>
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Source Warehouse</label>
                    <select name="from_warehouse_id" id="from_warehouse" required>
                        <option value="">Select warehouse</option>
                        {% for warehouse in warehouses %}
                        <option value="{{ warehouse.id }}">{{ warehouse.name }} ({{ warehouse.code }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Source Location</label>
                    <select name="from_location_id" id="from_location" required>
                        <option value="">Select location</option>
                        {% for location in locations %}
                        <option value="{{ location.id }}" data-warehouse="{{ location.warehouse_id }}">
                            {{ location.name }} ({{ location.code }})
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Products</label>
                <div id="product-lines">
                    <div class="line-item">
                        <div class="form-grid">
                            <div class="form-group">
                                <select name="product_id[]" required>
                                    <option value="">Select product</option>
                                    {% for product in products %}
                                    <option value="{{ product.id }}">{{ product.name }} ({{ product.sku }})</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="number" name="quantity[]" placeholder="Quantity" step="0.01" required>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" onclick="addLine()" class="btn btn-secondary btn-sm">Add Line</button>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Create Delivery</button>
                <a href="/operations/deliveries" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
function addLine() {
    const container = document.getElementById('product-lines');
    const template = container.querySelector('.line-item').cloneNode(true);
    template.querySelectorAll('select, input').forEach(input => input.value = '');
    container.appendChild(template);
}
</script>
{% endblock %}
